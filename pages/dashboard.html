<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/home.css">
    <link rel="stylesheet" href="../css/sales.css">
    <link rel="stylesheet" href="../css/inventory.css">
</head>
<body>
    <div id="importOverlay" class="import-overlay">
        <div class="import-container">
            <h2>Welcome to Sales Dashboard</h2>
            <p>To begin, please import your data or start with a new system.</p>
            <div class="import-options">
                <div class="import-option">
                    <h3>Import Existing Data</h3>
                    <p>Upload your existing Excel file with sales and inventory data</p>
                    <input type="file" id="initialExcelFile" accept=".xlsx, .xls" style="display: none;">
                    <label for="initialExcelFile" class="import-button">
                        Upload Excel File
                    </label>
                </div>
                <div class="import-option">
                    <h3>Start Fresh</h3>
                    <p>Begin with a new empty system</p>
                    <button id="startFreshButton" class="import-button">Start New System</button>
                </div>
            </div>
        </div>
    </div>

    <a href="#dashboard-content" class="skip-nav">Skip to main content</a>
    <div class="navbar" role="navigation" aria-label="Main navigation" style="display: none;">
        <div class="nav-left">
            <a href="#" data-section="home" class="nav-link active" title="Home Dashboard">
                <img src="../assets/icons/dashboard-icon.gif" alt="Home" style="width: 20px; height: 20px;">
            </a>
            <a href="#" data-section="sale" class="nav-link" title="Sales Management">
                <img src="../assets/icons/shop-icon.gif" alt="Sale" style="width: 20px; height: 20px;">
            </a>
            <a href="#" data-section="inventory" class="nav-link" title="Inventory Management">
                <img src="../assets/icons/inventory-icon.gif" alt="Inventory" style="width: 20px; height: 20px;">
            </a>
        </div>
        <div class="nav-right">
            <button type="button" class="btn btn-warning" id="exportButton">
                <img src="../assets/icons/download-icon.png" alt="Export" style="width: 20px; height: 20px;">
            </button>
            <input type="file" id="excelFile" accept=".xlsx, .xls" style="display: none;">
            <label for="excelFile" style="cursor: pointer;">
                <img src="../assets/icons/upload-icon.png" alt="Import" style="width: 20px; height: 20px;">
            </label>
        </div>
    </div>

    <div class="content" style="display: none;">
        <div id="dashboard-content" role="main"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import * as Home from '../js/home.js';
        import * as Sales from '../js/sales.js';
        import * as Inventory from '../js/inventory.js';

        // Initialize when the page loads
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Clear storage only if testing
                if (window.location.search.includes('test=true')) {
                    localStorage.clear();
                }

                // Initialize sales data
                await Sales.initializeSalesData();

                // Load initial home section
                const dashboardContent = document.getElementById('dashboard-content');
                if (dashboardContent) {
                    // Load template first
                    const response = await fetch('../pages/home-dashboard.html');
                    const template = await response.text();
                    dashboardContent.innerHTML = template;

                    // Initialize calendar and keyboard navigation after template is loaded
                    await Home.renderCalendar();
                    Home.initializeCalendarKeyboardNavigation();
                }

                // Make functions available globally
                window.addProduct = Inventory.addProduct;
                window.removeItem = Inventory.removeItem;
                window.searchInventory = Inventory.searchInventory;
                window.openEditProductPopup = Inventory.openEditProductPopup;
                window.addToCart = Sales.addToCart;
                window.removeFromCart = Sales.removeFromCart;
                window.finalizeSale = Sales.finalizeSale;
                window.printReceipt = Sales.printReceipt;
                window.navigateCalendar = Home.navigateCalendar;

            } catch (error) {
                console.error('Initialization error:', error);
            }
        });
    </script>
    <script type="module" src="../js/script.js"></script>
</body>
</html>